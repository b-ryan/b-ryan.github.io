<!DOCTYPE html>
<html lang="en">
  <head>


    <meta name="tags" contents="vim" />
    <meta name="tags" contents="registers" />
    <meta name="tags" contents="macros" />
    <meta name="tags" contents="programming" />


    <meta charset="utf-8" />
    <meta name="viewport" content="width-device-width, initial-scale=1.0">

    <script type="text/javascript"
      src="http://b-ryan.github.io/theme/lib/jquery/jquery-1.10.2.min.js"></script>
    <script type="text/javascript"
      src="http://b-ryan.github.io/theme/lib/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css"
      href="http://b-ryan.github.io/theme/lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"
      href="http://b-ryan.github.io/theme/css/layout.css">
    <link rel="stylesheet" type="text/css"
      href="http://b-ryan.github.io/theme/css/theme.css">
  </head>

  <body>

    <nav class="navbar navbar-default" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button
          type="button"
          class="navbar-toggle"
          data-toggle="collapse"
          data-target="#navbar-collapse"
        >
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://b-ryan.github.io">
          buckryan.com
        </a>
      </div>

      <div class="collapse navbar-collapse" id="navbar-collapse">
        <ul class="nav navbar-nav">

            <li >
              <a href="http://b-ryan.github.io/pages/about-me.html">about me</a>
            </li>

        </ul>
      </div>

    </div>
    </nav>

    <div class="container">
  <section id="content" class="body">

    <header>
      <h2 class="entry-title">
        <a
          href="http://b-ryan.github.io/drafts/manipulating-vim-registers.html"
          rel="bookmark"
          title="Permalink to Manipulating Vim Registers"
        >Manipulating Vim Registers</a>
      </h2>
      
    </header>

    <footer class="post-info">
      <span>
        2014-10-23
      </span>
        <address class="vcard author">
        </address>
    </footer>

    <div class="entry-content">
      <p>Recently I came across PHP code that looked similar to this:</p>
<div class="highlight"><pre><span class="k">const</span> <span class="n">YEAR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="n">QUARTER</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">const</span> <span class="n">MONTH</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="n">WEEK</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="n">DAY</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">const</span> <span class="n">HOUR</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="k">const</span> <span class="n">SECOND</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</pre></div>


<p>I needed to write a switch statement handling all of these cases. The desired
outcome was:</p>
<div class="highlight"><pre><span class="k">const</span> <span class="n">YEAR</span><span class="o">:</span>
<span class="k">const</span> <span class="n">QUARTER</span><span class="o">:</span>
<span class="k">const</span> <span class="n">MONTH</span><span class="o">:</span>
<span class="k">const</span> <span class="n">WEEK</span><span class="o">:</span>
<span class="k">const</span> <span class="n">DAY</span><span class="o">:</span>
<span class="k">const</span> <span class="n">HOUR</span><span class="o">:</span>
<span class="k">const</span> <span class="n">SECOND</span><span class="o">:</span>
</pre></div>


<p>An obvious way to do this would be to yank the whole text, paste it where you
want your switch statement to be, and then use a macro to modify each line
of text. <a href="http://blog.sanctum.geek.nz/advanced-vim-macros/">This article</a> is
a great writeup of more advanced macro techniques. Definitely read it.</p>
<p>However, it's possible to be more succinct by directly manipulating registers
(<a href="http://vimdoc.sourceforge.net/htmldoc/change.html#registers">:help registers</a>.
Only basic knowledge of how to do this is necessary to enable you to do some
cool stuff. Here are some examples to show the various ways to do that.</p>
<p>Clear out the contents of register <code>a</code>:</p>
<div class="highlight"><pre><span class="o">:</span><span class="n">let</span> <span class="err">@</span><span class="n">a</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</pre></div>


<p>Set the contents of register <code>c</code> to be the text <code>b is:</code> concatenated with the
contents of register <code>b</code>:</p>
<div class="highlight"><pre><span class="o">:</span><span class="n">let</span> <span class="err">@</span><span class="n">c</span> <span class="o">=</span> <span class="s">&quot;b is: &quot;</span> <span class="p">.</span> <span class="err">@</span><span class="n">b</span>
</pre></div>


<p>Now to see what is in register <code>c</code> you use:</p>
<div class="highlight"><pre><span class="o">:</span><span class="n">reg</span> <span class="n">c</span>
</pre></div>


<p>To replace register <code>d</code> with the current line:</p>
<div class="highlight"><pre><span class="s">&quot;dyy</span>
</pre></div>


<p>If you'd rather not replace what's in register <code>d</code>, but instead append to it,
you do:</p>
<div class="highlight"><pre><span class="s">&quot;Dyy</span>
</pre></div>


<p>Knowing just the above will get us far. Let's see how we can apply it toward
making our switch statement.</p>
<p>The first thing I'll do is show you how to get the contents of register <code>a</code>
to be</p>
<div class="highlight"><pre><span class="n">YEAR</span>
<span class="n">QUARTER</span>
<span class="n">MONTH</span>
<span class="n">WEEK</span>
<span class="n">DAY</span>
<span class="n">HOUR</span>
<span class="n">SECOND</span>
</pre></div>


<p>Go to the beginning of the word <code>YEAR</code> and record a macro:</p>
<div class="highlight"><pre><span class="s">&quot;Aywj</span>
</pre></div>


<p>Run this for every line and the contents of register a will be:</p>
<div class="highlight"><pre><span class="n">YEAR</span> <span class="n">QUARTER</span> <span class="n">MONTH</span> <span class="n">WEEK</span> <span class="n">DAY</span> <span class="n">HOUR</span> <span class="n">SECOND</span>
</pre></div>


<p>This is a good start, but I'd still have to add newlines. Let's see if we
can do better. This time, record this:</p>
<div class="highlight"><pre><span class="s">&quot;Ayw:let @a .= &quot;</span><span class="err">\</span><span class="n">n</span><span class="s">&quot;</span>
<span class="n">j</span>
</pre></div>


<p>The result is:</p>
<div class="highlight"><pre><span class="n">YEAR</span> 
<span class="n">QUARTER</span>

<span class="n">MONTH</span>

<span class="n">WEEK</span>

<span class="n">DAY</span>

<span class="n">HOUR</span>

<span class="n">SECOND</span>
</pre></div>


<p>Well that's not quite what I expected. There are extra newlines in there. Plus,
each word has an extra space at the end. After fiddling around, I discovered
that when a register ends in a newline, appending to it adds an extra newline!
It turns out when you assign to a register, if your expression ends with a
newline, Vim will treat the register linewise (see <code>:help linewise</code>). So it
will try to keep a newline at the end. See <code>:help let-@</code> for more info.</p>
<p>If you want to get around this, </p>
<p>:let @a .= "const :\n"
j</p>
    </div>
  </section>
    </div>


  </body>
</html>